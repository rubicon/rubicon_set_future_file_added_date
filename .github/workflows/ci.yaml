name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  lint:
    name: Lint (shellcheck)
    runs-on: macos-latest
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
        with:
          fetch-depth: 0
      - run: brew install shellcheck || true
      - run: shellcheck rubicon_set_future_file_added_date.sh

  format:
    name: Format check (shfmt)
    runs-on: macos-latest
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
        with:
          fetch-depth: 0
      - run: brew install shfmt || true
      - run: shfmt -w .

  test:
    name: Tests (bats)
    runs-on: macos-latest
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
        with:
          fetch-depth: 0
      - run: brew install bats-core || true
      - run: bats test || echo "⚠️ No tests found — skipping."

  build:
    name: Build and Test
    runs-on: macos-latest
    permissions:
      contents: read
    needs: [lint, format, test]
    steps:
      - uses: actions/checkout@v6
        with:
          fetch-depth: 0
      - run: echo "✅ All checks passed. Build complete."
